# Zmanim TRMNL Display

A TRMNL device display for Jewish halachic times (Zmanim) that dynamically shows relevant prayer times based on the time of day.

## Features

- **Dynamic Time Display**: Shows different times based on the current period:
  - **Before Chatzot (Midday)**: Shema and Tefilla (Shacharis) times
  - **After Chatzot, Before Sunset**: Mincha times and sunset
  - **After Sunset**: Nightfall (72 min) and Chatzot Night (midnight)

- **Real-time Updates**: Automatically updates based on current time
- **Location-based**: Uses zmanim data from your specific location
- **TRMNL Compatible**: Designed for TRMNL plugin integration

## Installation

1. Install Python dependencies:
   ```bash
   pip install -r requirements.txt
   ```

2. Ensure the zmanim data file exists:
   ```bash
   # The server expects zmanim data at:
   /var/lib/homebridge/zmanim-js/hebcal_zmanim.json
   ```

## Usage

Start the server:
```bash
python3 zmanim_server.py
```

The server will run on port 5001 and provide:
- `/` - Home page
- `/api/zmanim` - JSON API (requires API key)
- `/html` - HTML markup for TRMNL (requires API key)
- `/health` - Health check endpoint

## API Endpoints

### GET /api/zmanim
Returns JSON data with current zmanim information.

**Response:**
```json
{
  "period": "Shacharis",
  "current_time": "8:30 AM",
  "date": "February 14, 2025",
  "times": {
    "Shema (MGA)": "8:36 AM",
    "Shema (GR'A)": "9:28 AM",
    "Tefilla (MGA)": "9:46 AM",
    "Tefilla (GR'A)": "10:21 AM",
    "Chatzot": "12:06 PM"
  },
  "location": "Milwaukee, WI 53216"
}
```

### GET /html
Returns HTML markup for TRMNL display.

## TRMNL Integration

The `/html` endpoint provides formatted HTML that can be used directly with the TRMNL plugin. The display automatically adapts to show the most relevant times for the current period.

### TRMNL Configuration

**Polling URL:**
```
https://abie.live/zmanim/api/zmanim
```

**Polling Headers:**
```
Content-Type: application/json
```

**HTML Markdown (for markdown editor):**
```html
<iframe 
    src="https://abie.live/zmanim/html" 
    style="width: 100%; height: 100%; border: none; margin: 0; padding: 0;"
    frameborder="0"
    scrolling="no">
</iframe>
```

This configuration will:
1. Poll the JSON API to get current zmanim data
2. Display the formatted HTML content in an iframe
3. Automatically update throughout the day based on the current period

## Data Source

This application reads zmanim data from the `hebcal_zmanim.json` file generated by the zmanim-js system. The file should be updated daily with current zmanim calculations.

## License

This project is part of the TRMNL ecosystem for Jewish home automation.