{%- comment -%} Map TRMNL polling payload (IDX_0) to locals if present {%- endcomment -%}
{% if IDX_0 %}
  {% assign date = IDX_0.date %}
  {% assign current_time = IDX_0.current_time %}
  {% assign location = IDX_0.location %}
  {% assign period = IDX_0.period %}
  {% assign times = IDX_0.times %}
{% endif %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=800, height=480, initial-scale=1.0">
    <title>Zmanim Tracker</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }
        
        .container {
            width: 800px;
            height: 480px;
            margin: 0 auto;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: #333;
            color: white;
            padding: 15px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .header .subtitle {
            margin: 5px 0;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .header .location {
            margin: 5px 0 0 0;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .content {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .time-card {
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .time-card-header {
            background: #333;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
        }
        
        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            padding: 15px;
        }
        
        .time-item {
            text-align: center;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }
        
        .time-value {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin: 0 0 6px 0;
        }
        
        .time-label {
            font-size: 12px;
            color: #666;
            margin: 0;
            font-weight: 500;
        }
        
        .info-card {
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .info-content {
            padding: 20px;
            text-align: center;
            background: #f9f9f9;
        }
        
        .info-text {
            font-size: 15px;
            color: #333;
            margin: 0;
            line-height: 1.6;
        }
        
        .emoji {
            vertical-align: middle;
            margin-right: 8px;
        }
        
        /* E-ink optimized - no media queries needed for fixed size */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <img src="https://twemoji.maxcdn.com/v/latest/svg/1f54d.svg" width="28" height="28" class="emoji" alt="🕍">
                ZMANIM TRACKER
            </h1>
            <p class="subtitle">
                <img src="https://twemoji.maxcdn.com/v/latest/svg/1f4c5.svg" width="18" height="18" class="emoji" alt="📅">
                {{ date | default: "" }} • {{ current_time | default: "" }}
            </p>
            <p class="location">
                <img src="https://twemoji.maxcdn.com/v/latest/svg/1f4cd.svg" width="16" height="16" class="emoji" alt="📍">
                {{ location | default: "" }}
            </p>
        </div>
        
        <div class="content">
            <div class="time-card">
                <div class="time-card-header">
                    {% if period == "Morning" %}
                        <img src="https://twemoji.maxcdn.com/v/latest/svg/1f305.svg" width="20" height="20" class="emoji" alt="🌅">
                    {% elsif period == "Afternoon" %}
                        <img src="https://twemoji.maxcdn.com/v/latest/svg/2600.svg" width="20" height="20" class="emoji" alt="☀️">
                    {% elsif period == "Evening" %}
                        <img src="https://twemoji.maxcdn.com/v/latest/svg/1f319.svg" width="20" height="20" class="emoji" alt="🌙">
                    {% else %}
                        <img src="https://twemoji.maxcdn.com/v/latest/svg/1f4e6.svg" width="20" height="20" class="emoji" alt="📦">
                    {% endif %}
                    {{ period | upcase }}
                </div>
                <div class="time-grid">
                    {% if times and times.size > 0 %}
                        {% for time in times %}
                        <div class="time-item">
                            <p class="time-value">{{ time[1] }}</p>
                            <p class="time-label">{{ time[0] }}</p>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="time-item" style="grid-column: 1 / -1;">
                            <p class="time-value">No Data</p>
                            <p class="time-label">Times unavailable for current period</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            {% if period == "Morning" %}
            <div class="info-card">
                <div class="info-content">
                    <p class="info-text">
                        <strong>Shema:</strong> Must be recited before the latest time shown above<br>
                        <strong>Tefilla:</strong> Morning prayers should be completed before the latest time shown above
                    </p>
                </div>
            </div>
            {% elsif period == "Afternoon" %}
            <div class="info-card">
                <div class="info-content">
                    <p class="info-text">
                        <strong>Mincha:</strong> Afternoon prayers can be recited from Mincha Gedola until sunset<br>
                        <strong>Plag HaMincha:</strong> Earliest time to begin Maariv (evening prayers)
                    </p>
                </div>
            </div>
            {% else %}
            <div class="info-card">
                <div class="info-content">
                    <p class="info-text">
                        <strong>Tzeis:</strong> 72 minutes after sunset - nightfall for halachic purposes<br>
                        <strong>Chatzos Night:</strong> Halachic midnight (12 hours after chatzos day)
                    </p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</body>
</html>